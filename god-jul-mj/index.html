<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>@doktormjgjørjul2022</title>
    <link rel="icon" href="./player.png">
    <style>
        html, body {
  width:  100%;
  height: 100%;
  margin: 0;
}
    </style>
</head>

<body>
    <!--<h1>God Jul bby</h1>-->
    <p style="position:fixed; z-index: 10; color: white; left: 10px; top: 10px; margin: 0; font-family: sant-serif; font-size: 30px;"
    ><span>Lykke til</span><br><br><span>Score: </span><span id="scoreEl">0</span><span> av 10 000</span><br><br><span id="premieLink"></span><br><br><span id="gave"></span></p>
    <canvas></canvas>

    <script>
        const canvas = document.querySelector("canvas")
        const c = canvas.getContext("2d")

        const scoreEl = document.querySelector("#scoreEl")
        const premieLink = document.querySelector("#premieLink")

        const gaveLink = document.querySelector("#gave")

        canvas.width = innerWidth
        canvas.height = innerHeight

        var score = 0

        const speedDelta = 15
        var invaderRate = 0.99

        var projectileImgIdx = 0
        var invaderImgIdx = 0

        class Player {
            constructor() {
                this.position = {
                    x: 200,
                    y: 200
                }

                this.velocity = {
                    x: 0,
                    y: 0
                }

                this.rotation = 0

                const image = new Image()
                image.src = "./player.png"

                image.onload = () => {

                    this.image = image

                    this.width = image.width / 2
                    this.height = image.height / 2

                    this.position = {
                        x: canvas.width / 2 - this.width / 2,
                        y: canvas.height - this.height - 20
                    }


                }


            }

            draw() {
                //c.fillStyle = "red"
                //c.fillRect(this.position.x, this.position.y, this.width, this.height)

                //canvas.width  = window.innerWidth;
                //canvas.height = window.innerHeight;

                c.save()
                c.translate(player.position.x + player.width / 2, player.position.y + player.height / 2)
                c.rotate(player.rotation)
                c.translate(-player.position.x - player.width / 2, -player.position.y - player.height / 2)

                c.drawImage(this.image, this.position.x, this.position.y, this.width, this.height)

                c.restore()
            }

            update() {

                if (this.image) {

                    this.draw()
                    this.position.x += this.velocity.x
                    this.position.y += this.velocity.y

                }
                
            }
        }

        class Projectile {
            constructor({ position, velocity }) {
                this.position = position
                this.velocity = velocity
                this.radius = 5

                const image2 = new Image()

                projectileImgIdx += 1


                if (projectileImgIdx == 7){
                    image2.src = "./pills.png"
                    
                }
                else if (projectileImgIdx == 8){
                    image2.src = "./speculum.png"
                    image2.width *= 2
                    image2.height *= 2
                    
                }
                else if (projectileImgIdx == 9){
                    image2.src = "./hammer.png"
                    
                }
                else if (projectileImgIdx == 10){
                    image2.src = "./chainsaw.png"   
                    image2.width *= 2
                    image2.height *= 2
                    
                }
                else{
                    image2.src = "./vaksine.png"
                    image2.width *= 3
                    image2.height *= 3
                }
                if (projectileImgIdx >= 10){
                    projectileImgIdx = -1
                }
                

                this.image = image2


            }

            draw() {
                //c.beginPath()
                //c.arc(this.position.x, this.position.y, this.radius, 0, Math.PI*2)
                //c.fillStyle = "red"
                //c.fill()
                //c.closePath()

                c.drawImage(this.image, this.position.x, this.position.y, this.image.width/10, this.image.height/10)
            }

            update(){
                this.draw()
                this.position.x += this.velocity.x
                this.position.y += this.velocity.y
            }
        }

        const imageDrammen = new Image()
        imageDrammen.src = "./drammen-sykehus.png"
        imageDrammen.width *= 3
        imageDrammen.height *= 3

        const imageSpeculum = new Image()
        imageSpeculum.src = "./speculum.png"
        imageSpeculum.width *= 2
        imageSpeculum.height *= 2

        const imageTrondViggo = new Image()
        imageTrondViggo.src = "./Trond-Viggo-Torgersen.jpg"
        imageTrondViggo.width *= 2
        imageTrondViggo.height *= 2

        const imageOscar = new Image()
        imageOscar.src = "./oscar-boytoy.jpg"
        imageOscar.width *= 0.5
        imageOscar.height *= 0.5

        const imageSauda = new Image()
        imageSauda.src = "./sauda.png"
        imageSauda.width *= 3
        imageSauda.height *= 3

        const imageSuldal = new Image()
        imageSuldal.src = "./suldal.png"
        imageSuldal.width *= 3
        imageSuldal.height *= 3

        const imagePjusk = new Image()
        imagePjusk.src = "./pjusk.png"
        imagePjusk.width *= 3
        imagePjusk.height *= 3
        
        class Invader {
            constructor({position, velocity}) {
                this.position = position
                this.velocity = velocity

                //this.rotation = 0dffa

                const imageInvader = new Image()

                invaderImgIdx += 1

                this.imgIdx = invaderImgIdx


                if (invaderImgIdx == 7){
                    this.image = imageTrondViggo
                }
                else if (invaderImgIdx == 8){
                    this.image = imageSuldal
                    
                }
                else if (invaderImgIdx == 3){
                    this.image = imageOscar
                }
                else if (invaderImgIdx == 9){
                    this.image = imageSauda
                    
                }
                else{
                    this.image = imagePjusk
                }
                if (invaderImgIdx >= 10){
                    invaderImgIdx = -1
                }
                

                //this.image = imageInvader

                this.width = this.image.width / 10
                this.height = this.image.height / 10

                    //this.position = {
                    //    x: canvas.width / 2 - this.width / 2,
                    //    y: canvas.height /2
                    //}



            }

            draw() {
                //c.fillStyle = "red"
                //c.fillRect(this.position.x, this.position.y, this.width, this.height)

                //canvas.width  = window.innerWidth;
                //canvas.height = window.innerHeight;

                //c.save()
                //c.translate(player.position.x + player.width / 2, player.position.y + player.height / 2)
                //c.rotate(player.rotation)
                //c.translate(-player.position.x - player.width / 2, -player.position.y - player.height / 2)

                c.drawImage(this.image, this.position.x, this.position.y, this.width, this.height)

                //c.restore()
            }

            update() {

                if (this.image) {

                    this.draw()
                    this.position.x += this.velocity.x
                    this.position.y += this.velocity.y

                }
                
            }
        }

        
        

        const player = new Player()
        const projectiles = []
        const invaders = []

        const keys = {
            left: {
                pressed: false
            },
            right: {
                pressed: false
            },
            up: {
                pressed: false
            },
            down: {
                pressed: false
            },
            shoot: {
                pressed: false
            }
        }

        function animate() {
            requestAnimationFrame(animate)

            c.fillStyle = "black"
            c.fillRect(0, 0, canvas.width, canvas.height)

            

            // Changing player position on keys
            if (keys.left.pressed && player.position.x >= 0){
                player.velocity.x = -1 * speedDelta
                player.rotation = -.15
            }
            else if (keys.right.pressed && player.position.x <= canvas.width - player.width){
                player.velocity.x = 1 * speedDelta
                player.rotation = .15
            }
            else if (keys.up.pressed && player.position.y >= 0){
                player.velocity.y = -1 * speedDelta
            }
            else if (keys.down.pressed && player.position.y <= canvas.height - player.height){
                player.velocity.y = 1 * speedDelta
            }
            else {
                player.velocity.x = 0
                player.velocity.y = 0
                player.rotation = 0
            }

            if (player.position.x < 0){
                player.position.x = 0
            }
            else if (player.position.x > canvas.width - player.width){
                player.position.x = canvas.width - player.width
            }

            if (player.position.y < 0){
                player.position.y = 0
            }
            else if (player.position.y > canvas.height - player.height){
                player.position.y = canvas.height - player.height
            }
            
            player.update()

            

            if (Math.random() > invaderRate){

                //console.log("FISK")

                var x = Math.floor(Math.random() * canvas.width)

                invaders.push(
                    new Invader({
                        position: {
                            x: x,
                            y: 0
                        },
                        velocity: {
                            x: 0,
                            y: 5
                        }
                    })
                )
            }

            // invaders
            invaders.forEach((invader, idx)=>{

                

                if (invader.position.y > canvas.height){
                    //console.log("GAME OVER")
                    setTimeout(()=>{
                        invaders.splice(idx, 1)
                    }, 0)
                    //invaders = []
                }
                else{
                    //console.log(invaders)
                    //print(invaders.at(-1).position.x)
                    invader.update()
                }

                projectiles.forEach((projectile, jdx)=>{
                    if (projectile.position.y >= invader.position.y 
                    && projectile.position.y <= invader.position.y + invader.image.height 
                    && projectile.position.x >= invader.position.x 
                    && projectile.position.x <= invader.position.x + invader.image.width
                    ){
                        setTimeout(()=>{
                        invaders.splice(idx, 1)
                        projectiles.splice(jdx, 1)

                        score += 100
                        
                        })

                        if (score > 1000){
                            premieLink.innerHTML = "Bra, gi dem inn"
                        }

                        if (invader.imgIdx == 3){
                            premieLink.innerHTML = "Auch, ikke skyt meg; skyt heller Trond Vigg o..."
                            score = 0
                        }

                        scoreEl.innerHTML = score

                        if (score >= 1000){
                            alert("BRAVO! Da gjenstår kun siste hindring; klar? :)<3");
                            let fifaYear = prompt("Når ble FIFA grunnlagt sa du?", "")
                            if (fifaYear == "2004"){
                                score = 0
                                gaveLink.innerHTML = "<a href='./god-jul-mj.jpg' download style='font-size:30px;color:pink;'>Du er ok+, klikk her</a>"
                            }
                            else{
                                score = -1000
                                premieLink.innerHTML = "...."
                            }
                            
                        }
                    }
                })
            })



            // Projectiles
            projectiles.forEach((projectile, idx)=>{

                if (projectile.position.y < 0){
                    setTimeout(()=>{
                        projectiles.splice(idx, 1)
                    }, 0)
                    

                }
                else{
                    projectile.update()
                }
            })
            
        }

        animate()

        function startup() {
            canvas.addEventListener('touchstart', (event)=>{
                player.position.x = e.touches[0].clientX
                player.position.y = e.touches[0].clientY
            });
            //canvas.addEventListener('touchend', handleEnd);
            //canvas.addEventListener('touchcancel', handleCancel);
            canvas.addEventListener('touchmove', (event)=>{
                player.position.x = e.touches[0].clientX
                player.position.y = e.touches[0].clientY
            });
            //log('Initialized.');
        }

document.addEventListener("DOMContentLoaded", startup);

        // Getting keydown events
        addEventListener("keydown", ({ key }) => {

            //console.log(key)

            if (key == "ArrowLeft" || key == "a") {

                //console.log("Start Left")
                keys.left.pressed = true

            }
            else if (key == "ArrowRight" || key == "d") {

                //console.log("Start Right")
                keys.right.pressed = true

            }
            else if (key == "ArrowUp" || key == "w") {

                //console.log("Start Up")
                keys.up.pressed = true

            }
            else if (key == "ArrowDown" || key == "s") {

                //console.log("Start Down")
                keys.down.pressed = true

            }
            else if (key == " " || key == "d") {

                //console.log("Start Shoot")

                projectiles.push(
                    new Projectile({
                        position: {
                            x: player.position.x,
                            y: player.position.y
                        },
                        velocity: {
                            x: 0,
                            y: -7
                        }
                    })
                )

            }
            else if (key == "Escape" || key == "p") {

                //console.log("Start Menu")

            }
            else if (key == "+") {

                //console.log("+")
                invaderRate += 0.01

                if (invaderRate > 0.99){
                    invaderRate = 0.99
                }
            }

            else if (key == "-") {

                //console.log("+")
                invaderRate -= 0.01

                if (invaderRate < 0.01){
                invaderRate = 0.01
            }
}

        })

        addEventListener("keyup", ({ key }) => {

//console.log(key)


if (key == "ArrowLeft" || key == "a") {

    //console.log("Stop Left")
    keys.left.pressed = false

}
else if (key == "ArrowRight" || key == "d") {

    //console.log("Stop Right")
    keys.right.pressed = false

}
else if (key == "ArrowUp" || key == "w") {

//console.log("Start Up")
keys.up.pressed = false

}
else if (key == "ArrowDown" || key == "s") {

//console.log("Start Down")
keys.down.pressed = false

}
else if (key == " " || key == "d") {

    //console.log("Stop shoot")
    //player.position.x += 5

}
else if (key == "Escape" || key == "p") {

    //console.log("Stop Menu")

}

})

//window.addEventListener("resize", ()=>{
//            canvas.width  = window.width,
//            canvas.height = window.height
//            
//        })


    </script>
</body>

</html>