<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MJs jul</title>
    <link rel="icon" href="./player.png">
    <style>
        html, body {
  width:  100%;
  height: 100%;
  margin: 0;
}
    </style>
</head>

<body>
    <!--<h1>God Jul bby</h1>-->
    <canvas></canvas>

    <script>
        const canvas = document.querySelector("canvas")
        const c = canvas.getContext("2d")

        canvas.width = innerWidth
        canvas.height = innerHeight

        
        var projectileImgIdx = 0

        class Player {
            constructor() {
                this.position = {
                    x: 200,
                    y: 200
                }

                this.velocity = {
                    x: 0,
                    y: 0
                }

                this.rotation = 0

                const image = new Image()
                image.src = "./player.png"

                image.onload = () => {

                    this.image = image

                    this.width = image.width / 2
                    this.height = image.height / 2

                    this.position = {
                        x: canvas.width / 2 - this.width / 2,
                        y: canvas.height - this.height - 20
                    }

                }


            }

            draw() {
                //c.fillStyle = "red"
                //c.fillRect(this.position.x, this.position.y, this.width, this.height)

                //canvas.width  = window.innerWidth;
                //canvas.height = window.innerHeight;

                c.save()
                c.translate(player.position.x + player.width / 2, player.position.y + player.height / 2)
                c.rotate(player.rotation)
                c.translate(-player.position.x - player.width / 2, -player.position.y - player.height / 2)

                c.drawImage(this.image, this.position.x, this.position.y, this.width, this.height)

                c.restore()
            }

            update() {

                if (this.image) {

                    this.draw()
                    this.position.x += this.velocity.x
                    this.position.y += this.velocity.y

                }
                
            }
        }

        class Projectile {
            constructor({ position, velocity }) {
                this.position = position
                this.velocity = velocity
                this.radius = 5

                const image2 = new Image()

                projectileImgIdx += 1


                if (projectileImgIdx == 8){
                    image2.src = "./pills.png"
                    
                }
                else if (projectileImgIdx == 9){
                    image2.src = "./hammer.png"
                    
                }
                else if (projectileImgIdx == 10){
                    image2.src = "./chainsaw.png"   
                    image2.width *= 2
                    image2.height *= 2
                    
                }
                else{
                    image2.src = "./vaksine.png"
                    image2.width *= 3
                    image2.height *= 3
                }
                if (projectileImgIdx >= 10){
                    projectileImgIdx = -1
                }
                

                this.image = image2
            }

            draw() {
                //c.beginPath()
                //c.arc(this.position.x, this.position.y, this.radius, 0, Math.PI*2)
                //c.fillStyle = "red"
                //c.fill()
                //c.closePath()

                c.drawImage(this.image, this.position.x, this.position.y, this.image.width/10, this.image.height/10)
            }

            update(){
                this.draw()
                this.position.x += this.velocity.x
                this.position.y += this.velocity.y
            }
        }
        
        const speedDelta = 5

        const player = new Player()
        const projectiles = []

        const keys = {
            left: {
                pressed: false
            },
            right: {
                pressed: false
            },
            up: {
                pressed: false
            },
            down: {
                pressed: false
            },
            shoot: {
                pressed: false
            }
        }
        //player.draw()

        function animate() {
            requestAnimationFrame(animate)

            c.fillStyle = "black"
            c.fillRect(0, 0, canvas.width, canvas.height)

            // Changing player position on keys
            if (keys.left.pressed && player.position.x >= 0){
                player.velocity.x = -1 * speedDelta
                player.rotation = -.15
            }
            else if (keys.right.pressed && player.position.x <= canvas.width - player.width){
                player.velocity.x = 1 * speedDelta
                player.rotation = .15
            }
            else if (keys.up.pressed && player.position.y >= 0){
                player.velocity.y = -1 * speedDelta
            }
            else if (keys.down.pressed && player.position.y <= canvas.height - player.height){
                player.velocity.y = 1 * speedDelta
            }
            else {
                player.velocity.x = 0
                player.velocity.y = 0
                player.rotation = 0
            }

            if (player.position.x < 0){
                player.position.x = 0
            }
            else if (player.position.x > canvas.width - player.width){
                player.position.x = canvas.width - player.width
            }

            if (player.position.y < 0){
                player.position.y = 0
            }
            else if (player.position.y > canvas.height - player.height){
                player.position.y = canvas.height - player.height
            }
            
            player.update()

            // Projectiles
            projectiles.forEach(projectile=>{
                projectile.update()
            })
            
        }

        animate()

        function startup() {
            canvas.addEventListener('touchstart', (event)=>{
                player.position.x = e.touches[0].clientX
                player.position.y = e.touches[0].clientY
            });
            //canvas.addEventListener('touchend', handleEnd);
            //canvas.addEventListener('touchcancel', handleCancel);
            canvas.addEventListener('touchmove', (event)=>{
                player.position.x = e.touches[0].clientX
                player.position.y = e.touches[0].clientY
            });
            //log('Initialized.');
        }

document.addEventListener("DOMContentLoaded", startup);

        // Getting keydown events
        addEventListener("keydown", ({ key }) => {

            console.log(key)

            if (key == "ArrowLeft" || key == "a") {

                console.log("Start Left")
                keys.left.pressed = true

            }
            else if (key == "ArrowRight" || key == "d") {

                console.log("Start Right")
                keys.right.pressed = true

            }
            else if (key == "ArrowUp" || key == "w") {

                console.log("Start Up")
                keys.up.pressed = true

            }
            else if (key == "ArrowDown" || key == "s") {

                console.log("Start Down")
                keys.down.pressed = true

            }
            else if (key == " " || key == "d") {

                console.log("Start Shoot")

                projectiles.push(
                    new Projectile({
                        position: {
                            x: player.position.x,
                            y: player.position.y
                        },
                        velocity: {
                            x: 0,
                            y: -5
                        }
                    })
                )

            }
            else if (key == "Escape" || key == "p") {

                console.log("Start Menu")

            }

        })

        addEventListener("keyup", ({ key }) => {

console.log(key)


if (key == "ArrowLeft" || key == "a") {

    console.log("Stop Left")
    keys.left.pressed = false

}
else if (key == "ArrowRight" || key == "d") {

    console.log("Stop Right")
    keys.right.pressed = false

}
else if (key == "ArrowUp" || key == "w") {

console.log("Start Up")
keys.up.pressed = false

}
else if (key == "ArrowDown" || key == "s") {

console.log("Start Down")
keys.down.pressed = false

}
else if (key == " " || key == "d") {

    console.log("Stop shoot")
    //player.position.x += 5

}
else if (key == "Escape" || key == "p") {

    console.log("Stop Menu")

}

})

//window.addEventListener("resize", ()=>{
//            canvas.width  = window.width,
//            canvas.height = window.height
//            
//        })


    </script>
</body>

</html>