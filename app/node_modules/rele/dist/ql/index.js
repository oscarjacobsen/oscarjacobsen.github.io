'use strict';

var _Object$defineProperty = require('babel-runtime/core-js/object/define-property')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

_Object$defineProperty(exports, '__esModule', {
  value: true
});

exports.rawql = rawql;
exports.ql = ql;

var _tokenize = require('./tokenize');

var _tokenize2 = _interopRequireDefault(_tokenize);

var _parse = require('./parse');

var _parse2 = _interopRequireDefault(_parse);

var _optimize = require('./optimize');

var _optimize2 = _interopRequireDefault(_optimize);

var _traverse = require('./traverse');

var _traverse2 = _interopRequireDefault(_traverse);

function rawql(_ref) {
  for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    args[_key - 1] = arguments[_key];
  }

  var raw = _ref.raw;

  var tokens = (0, _tokenize2['default'])(raw);
  var ast = (0, _parse2['default'])(tokens, args);

  return ast;
}

function ql(_ref2) {
  for (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
    args[_key2 - 1] = arguments[_key2];
  }

  var raw = _ref2.raw;

  var tokens = (0, _tokenize2['default'])(raw);
  var ast = (0, _optimize2['default'])((0, _parse2['default'])(tokens, args));

  return function (params) {
    return (0, _traverse2['default'])(ast, function (node) {
      if (node.type === 'param') {
        return params[node.name];
      }

      return node;
    });
  };
}